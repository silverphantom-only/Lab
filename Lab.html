<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Generador de p√°ginas para Laboratoristas</title>

  <style>
    :root{
      --accent:#0077c2;
      --bg:#ffffff;
      --text:#222;
      --muted:#666;
      --card:#f7f9fc;
      --brand-font: "Helvetica Neue", Arial, sans-serif;
    }

    body{
      margin:0;
      font-family:var(--brand-font);
      background:linear-gradient(180deg,#f1f4f8,white);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    header.appbar{
      display:flex;
      gap:16px;
      align-items:center;
      padding:18px 24px;
      background:rgba(255,255,255,0.9);
      box-shadow:0 2px 6px rgba(20,30,50,0.06);
      position:sticky;
      top:0;
      z-index:10;
    }

    .logo-preview{
      width:48px;height:48px;border-radius:8px;background:var(--card);
      display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--muted);
      overflow:hidden;
    }

    .app-title{font-weight:700;font-size:18px}

    main{
      display:grid;
      grid-template-columns:420px 1fr;
      gap:20px;
      padding:20px;
      max-width:1200px;
      margin:18px auto;
      width:calc(100% - 48px);
    }

    .panel{
      background:white;
      padding:16px;
      border-radius:10px;
      box-shadow:0 6px 20px rgba(30,40,60,0.06);
      overflow:auto;
      max-height:75vh;
    }

    .panel h2{margin:0 0 12px 0;font-size:16px}

    label{
      display:block;
      margin:8px 0 6px 0;
      font-size:13px;
      color:var(--muted);
    }

    input[type="text"], input[type="color"], textarea, select{
      width:100%;
      padding:8px;
      border-radius:8px;
      border:1px solid #e5edf5;
      background:#fff;
      box-sizing:border-box;
      font-size:14px;
    }

    textarea{min-height:70px;resize:vertical}

    .row{display:flex;gap:10px}

    .btn{
      appearance:none;
      border:0;
      padding:10px 12px;
      border-radius:8px;
      background:var(--accent);
      color:white;
      cursor:pointer;
      font-weight:600;
    }

    .btn.secondary{
      background:#f1f3f5;
      color:var(--text);
    }

    .sections-list{margin-top:8px;display:flex;flex-direction:column;gap:10px}

    .section-item{
      padding:8px;
      border-radius:8px;
      border:1px dashed #e6eef8;
      background:linear-gradient(180deg,#fff,#fbfdff);
    }

    .section-item .controls{display:flex;gap:8px;align-items:center;margin-top:8px}

    .preview-wrap{display:flex;flex-direction:column;gap:10px;height:75vh}

    iframe#preview{
      flex:1;
      border-radius:10px;
      border:1px solid #e2e8f0;
      background:white;
    }

    .actions{display:flex;gap:8px;flex-wrap:wrap}

    .small{font-size:12px;color:var(--muted)}

    .help{font-size:13px;color:var(--muted);margin-top:8px}

    footer.credits{
      padding:12px;
      text-align:center;
      color:var(--muted);
      font-size:13px;
    }

    .hint{font-size:13px;color:#4b5563}

    .color-swatch{
      display:inline-block;
      width:18px;height:18px;
      border-radius:4px;
      border:1px solid rgba(0,0,0,0.06);
      vertical-align:middle;
      margin-left:6px;
    }

    /* ---------------------------
       NUEVO SISTEMA DE SERVICIOS
       --------------------------- */

    .service-row{
      border:1px solid #dfe7f3;
      padding:10px;
      border-radius:8px;
      background:#f9fbff;
      margin-bottom:8px;
    }

    .service-row input,
    .service-row textarea{
      margin-top:4px;
    }

    .service-actions{
      display:flex;
      gap:6px;
      margin-top:8px;
    }

    .service-card{
      background:white;
      border-radius:10px;
      padding:16px;
      border:1px solid #e3e9f5;
      box-shadow:0 4px 15px rgba(20,40,80,0.04);
      margin-bottom:14px;
    }

    .service-title{
      font-size:18px;
      font-weight:700;
    }

    .service-price{
      font-size:17px;
      color:var(--accent);
      margin:4px 0 8px 0;
      font-weight:600;
    }

    .service-desc{
      color:#444;
      line-height:1.45;
      margin-bottom:10px;
    }

    .service-btns{
      display:flex;
      gap:10px;
    }

    .service-btn{
      flex:1;
      padding:10px;
      border-radius:8px;
      color:white;
      text-align:center;
      text-decoration:none;
      font-weight:600;
      display:block;
    }

    .btn-wsp{background:#25d366}
    .btn-call{background:#0077c2}

  </style>
</head>

<body>
  <header class="appbar">
    <div class="logo-preview" id="appLogo">LAB</div>

    <div>
      <div class="app-title">Generador de P√°ginas ‚Äî Laboratoristas</div>
      <div class="small">Plantillas replicables ‚Äî cambia pocas cosas y listo</div>
    </div>
  </header>

  <main>
    <!-- LEFT: controles -->
    <section class="panel" aria-label="Controles">

      <h2>Configuraci√≥n b√°sica</h2>

      <label for="labName">Nombre del laboratorio</label>
      <input id="labName" type="text" value="Laboratorio Cl√≠nico San Jos√©" />

      <label for="tagline">Tagline / Descripci√≥n corta</label>
      <input id="tagline" type="text" value="Diagn√≥stico confiable | Resultados r√°pidos" />

      <div class="row" style="margin-top:8px">
        <div style="flex:1">
          <label for="accent">Color principal</label>
          <input id="accent" type="color" value="#0077c2" />
        </div>

        <div style="flex:1">
          <label for="textColor">Color de texto</label>
          <input id="textColor" type="color" value="#222222" />
        </div>
      </div>

      <label for="logoFile">Logo (PNG/JPG, opcional)</label>
      <input id="logoFile" type="file" accept="image/*" />

      <label for="heroImageUrl">URL de imagen de cabecera (opcional)</label>
      <input id="heroImageUrl" type="text" placeholder="https://..." />
      <!-- ============================
           NUEVO SISTEMA DE SERVICIOS
         ============================-->

      <h2 style="margin-top:20px">Servicios (con precios)</h2>

      <div id="servicesList"></div>

      <button id="addServiceBtn" class="btn" style="margin-top:10px">+ A√±adir servicio</button>


      <!-- ====================================================
           RESTO DEL PANEL IZQUIERDO (SECCIONES GENERALES)
      ===================================================== -->

      <div style="height:18px"></div>

      <h2>Secciones adicionales (editable)</h2>

      <div class="sections-list" id="sectionsList">
        <!-- Render din√°mico -->
      </div>

      <div style="display:flex;gap:8px;margin-top:10px">
        <button class="btn" id="addSectionBtn">+ A√±adir secci√≥n</button>
        <button class="btn secondary" id="resetSectionsBtn">Restablecer plantilla</button>
      </div>


      <div style="height:14px"></div>

      <h2>Exportar / Previsualizar</h2>
      <div class="actions">
        <button class="btn" id="generateBtn">Generar HTML</button>
        <button class="btn secondary" id="downloadBtn">Descargar .html</button>
        <button class="btn secondary" id="openNewTabBtn">Abrir en nueva pesta√±a</button>
      </div>

      <div class="help">Tip: puedes reordenar servicios y secciones libremente. ‚úîÔ∏è</div>
    </section>


    <!-- ======================
         RIGHT: PREVIEW
    ====================== -->

    <section class="panel preview-wrap" aria-label="Previsualizaci√≥n">
      <h2>Previsualizaci√≥n</h2>
      <iframe id="preview" title="Vista previa"></iframe>
      <div class="small">
        Las modificaciones se reflejan en la vista previa.  
      </div>
    </section>

  </main>

  <footer class="credits">
    Hecho para laboratoristas ‚Äî cambia textos, colores e im√°genes ‚òëÔ∏è
  </footer>


  <!-- ====================================================
       ===================== SCRIPT ========================
       ====================================================-->

<script>
/* ===========================================================
   SISTEMA DE DATOS INICIAL
   =========================================================== */

const defaultConfig = {
  labName: "Laboratorio Cl√≠nico San Jos√©",
  tagline: "Diagn√≥stico confiable | Resultados r√°pidos",
  accent: "#0077c2",
  textColor: "#222222",
  logoData: null,
  heroImage: "",

  services: [
    {
      id: idGen(),
      icon: "üß™",
      name: "Biometr√≠a Hem√°tica",
      price: "$180 MXN",
      desc: "Estudio general para evaluar c√©lulas sangu√≠neas."
    },
    {
      id: idGen(),
      icon: "üß¨",
      name: "Prueba PCR",
      price: "$850 MXN",
      desc: "Detecci√≥n molecular de virus mediante PCR."
    }
  ],

  sections: [
    { id: idGen(), title: "Sobre nosotros", content: "<p>Somos un laboratorio cl√≠nico con m√°s de 15 a√±os de experiencia.</p>" },
    { id: idGen(), title: "Contacto", content: "<p>Direcci√≥n: Av. Siempre Viva 123<br>Tel: +52 55 0000 0000</p>" }
  ]
};


/* ===========================================================
   VARIABLES DE APLICACI√ìN
   =========================================================== */

const state = JSON.parse(JSON.stringify(defaultConfig));
const el = (id) => document.getElementById(id);

const servicesList = el("servicesList");
const addServiceBtn = el("addServiceBtn");

const labNameInput   = el("labName");
const taglineInput   = el("tagline");
const accentInput    = el("accent");
const textColorInput = el("textColor");
const logoFileInput  = el("logoFile");
const heroImageInput = el("heroImageUrl");

const logoBox        = el("appLogo");
const sectionsList   = el("sectionsList");

const addSectionBtn     = el("addSectionBtn");
const resetSectionsBtn  = el("resetSectionsBtn");
const generateBtn       = el("generateBtn");
const downloadBtn       = el("downloadBtn");
const openNewTabBtn     = el("openNewTabBtn");
const previewIframe     = el("preview");


/* ===========================================================
   RENDER DE SERVICIOS
   =========================================================== */

function renderServices() {
  servicesList.innerHTML = "";

  state.services.forEach((srv, i) => {
    const d = document.createElement("div");
    d.className = "service-row";
    d.dataset.id = srv.id;

    d.innerHTML = `
      <label>√çcono (emoji o URL)</label>
      <input type="text" class="srv-icon" value="${srv.icon}"/>

      <label>Nombre del servicio</label>
      <input type="text" class="srv-name" value="${srv.name}"/>

      <label>Precio</label>
      <input type="text" class="srv-price" value="${srv.price}"/>

      <label>Descripci√≥n</label>
      <textarea class="srv-desc">${srv.desc}</textarea>

      <div class="service-actions">
        <button class="btn saveServiceBtn">Guardar</button>
        <button class="btn secondary delServiceBtn">Eliminar</button>
        <button class="btn secondary upServiceBtn">‚Üë</button>
        <button class="btn secondary downServiceBtn">‚Üì</button>
      </div>
    `;

    servicesList.appendChild(d);
  });
}


/* ===========================================================
   EVENTOS DE SERVICIOS
   =========================================================== */

servicesList.addEventListener("click", (ev) => {
  const box = ev.target.closest(".service-row");
  if (!box) return;

  const id = box.dataset.id;
  const srv = state.services.find(s => s.id === id);

  if (ev.target.classList.contains("saveServiceBtn")) {
    srv.icon = box.querySelector(".srv-icon").value;
    srv.name = box.querySelector(".srv-name").value;
    srv.price = box.querySelector(".srv-price").value;
    srv.desc = box.querySelector(".srv-desc").value;

    updatePreview();
  }

  if (ev.target.classList.contains("delServiceBtn")) {
    state.services = state.services.filter(s => s.id !== id);
    renderServices();
    updatePreview();
  }

  if (ev.target.classList.contains("upServiceBtn")) {
    const index = state.services.findIndex(s => s.id === id);
    if (index > 0) {
      [state.services[index - 1], state.services[index]] =
        [state.services[index], state.services[index - 1]];
      renderServices();
      updatePreview();
    }
  }

  if (ev.target.classList.contains("downServiceBtn")) {
    const index = state.services.findIndex(s => s.id === id);
    if (index < state.services.length - 1) {
      [state.services[index + 1], state.services[index]] =
        [state.services[index], state.services[index + 1]];
      renderServices();
      updatePreview();
    }
  }
});


addServiceBtn.addEventListener("click", () => {
  state.services.push({
    id: idGen(),
    icon: "ü©∫",
    name: "Nuevo servicio",
    price: "$0 MXN",
    desc: "Descripci√≥n del servicio"
  });
  renderServices();
  updatePreview();
});


/* ===========================================================
   RENDER DE SECCIONES (SE MANTIENE COMO EN PARTE 1)
   =========================================================== */

function renderSectionsControls() {
  sectionsList.innerHTML = "";

  state.sections.forEach((s) => {
    const item = document.createElement("div");
    item.className = "section-item";
    item.dataset.id = s.id;

    item.innerHTML = `
      <div style="display:flex;justify-content:space-between;align-items:center">
        <strong>${escapeHtml(s.title)}</strong>
        <div style="display:flex;gap:6px">
          <button class="btn small editBtn">Editar</button>
          <button class="btn secondary small delBtn">Eliminar</button>
        </div>
      </div>

      <div style="margin-top:8px">
        <div class="s-content"
             style="min-height:60px;padding:8px;border-radius:6px;border:1px solid #eef6ff;background:#fff"
             contenteditable="true">${s.content}</div>

        <div class="controls">
          <input type="text" class="s-title-input" value="${escapeAttr(s.title)}" style="flex:1" />
          <button class="btn saveBtn small">Guardar</button>
        </div>
      </div>
    `;

    sectionsList.appendChild(item);
  });
}

/* ===========================================================
   EVENTOS DE SECCIONES
   =========================================================== */

sectionsList.addEventListener("click", (e) => {
  const item = e.target.closest(".section-item");
  if (!item) return;

  const id = item.dataset.id;
  const section = state.sections.find((s) => s.id === id);

  if (e.target.classList.contains("delBtn")) {
    state.sections = state.sections.filter((s) => s.id !== id);
    renderSectionsControls();
    updatePreview();
  }

  if (e.target.classList.contains("saveBtn")) {
    const newTitle = item.querySelector(".s-title-input").value;
    const newContent = item.querySelector(".s-content").innerHTML;

    section.title = newTitle;
    section.content = newContent;

    renderSectionsControls();
    updatePreview();
  }
});

addSectionBtn.addEventListener("click", () => {
  state.sections.push({
    id: idGen(),
    title: "Nueva secci√≥n",
    content: "<p>Contenido de la nueva secci√≥n.</p>"
  });
  renderSectionsControls();
  updatePreview();
});

resetSectionsBtn.addEventListener("click", () => {
  state.sections = JSON.parse(JSON.stringify(defaultConfig.sections));
  renderSectionsControls();
  updatePreview();
});


/* ===========================================================
   ACTUALIZAR DATOS GENERALES
   =========================================================== */

labNameInput.addEventListener("input", () => { state.labName = labNameInput.value; updatePreview(); });
taglineInput.addEventListener("input", () => { state.tagline = taglineInput.value; updatePreview(); });
accentInput.addEventListener("input", () => { state.accent = accentInput.value; updatePreview(); });
textColorInput.addEventListener("input", () => { state.textColor = textColorInput.value; updatePreview(); });
heroImageInput.addEventListener("input", () => { state.heroImage = heroImageInput.value; updatePreview(); });


/* LOGO BASE64 */
logoFileInput.addEventListener("change", () => {
  const file = logoFileInput.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = (e) => {
    state.logoData = e.target.result;
    logoBox.src = e.target.result;
    updatePreview();
  };
  reader.readAsDataURL(file);
});


/* ===========================================================
   GENERAR HTML FINAL
   =========================================================== */

function generateFinalHtml() {
  const { labName, tagline, accent, textColor, logoData, heroImage, services, sections } = state;

  const serviceCards = services.map((s) => {
    const iconHtml = s.icon
      ? (s.icon.startsWith("http") ? `<img src="${s.icon}" style="width:50px;height:50px;border-radius:6px;border:1px solid #ddd">`
                                  : `<div style="font-size:40px">${s.icon}</div>`)
      : "";

    return `
      <div class="service-card">
        <div class="s-icon">${iconHtml}</div>
        <div class="s-info">
          <h3>${escapeHtml(s.name)}</h3>
          <div class="price">${escapeHtml(s.price)}</div>
          <p class="desc">${escapeHtml(s.desc)}</p>

          <div class="buttons">
            <a class="btn consult" href="https://wa.me/?text=${encodeURIComponent(
              "Hola, quiero informaci√≥n sobre: " + s.name
            )}" target="_blank">üí¨ Consultar</a>

            <a class="btn reserve" href="https://wa.me/?text=${encodeURIComponent(
              "Hola, quiero agendar una cita para: " + s.name + (s.price ? " (" + s.price + ")" : "")
            )}" target="_blank">üìÖ Reservar / Agendar</a>
          </div>
        </div>
      </div>
    `;
  }).join("");


  const sectionsHtml = sections
    .map((s) => `<section class="box"><h2>${escapeHtml(s.title)}</h2>${s.content}</section>`)
    .join("");


  return `
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>${escapeHtml(labName)}</title>

<style>
  body { margin:0; font-family:Arial; background:#f6f9ff; color:${textColor}; }
  header { text-align:center; padding:20px; background:white; border-bottom:3px solid ${accent}; }
  header img { width:120px; }
  .tagline { color:${accent}; font-size:18px; margin-top:6px }
  .hero { width:100%; max-height:320px; object-fit:cover }

  .container { max-width:880px; margin:auto; padding:20px }
  h2 { color:${accent}; }

  .service-card {
    background:white;
    border-radius:12px;
    padding:18px;
    display:flex;
    gap:18px;
    border:1px solid #e8efff;
    box-shadow:0 2px 6px rgba(0,0,0,0.06);
    margin-bottom:18px;
  }

  .s-info h3 { margin:0; font-size:22px }
  .price { font-weight:bold; margin:6px 0; font-size:18px }
  .desc { margin:0 }

  .s-icon { min-width:60px; display:flex; align-items:center; }

  .buttons { margin-top:12px; display:flex; gap:10px; flex-wrap:wrap }
  .btn {
    padding:10px 14px;
    border-radius:8px;
    text-decoration:none;
    color:white;
    font-weight:bold;
    display:inline-block;
  }
  .btn.consult { background:#25D366; }
  .btn.reserve { background:${accent}; }

  .box {
    background:white;
    padding:18px;
    border-radius:10px;
    border:1px solid #e8efff;
    margin-top:20px;
  }

  footer {
    text-align:center;
    padding:20px;
    color:#546;
    margin-top:20px;
  }
</style>

</head>
<body>

<header>
  ${logoData ? `<img src="${logoData}">` : ""}
  <h1>${escapeHtml(labName)}</h1>
  <div class="tagline">${escapeHtml(tagline)}</div>
</header>

${heroImage ? `<img class="hero" src="${heroImage}">` : ""}

<div class="container">

  <h2>Servicios</h2>
  ${serviceCards}

  ${sectionsHtml}

</div>

<footer>¬© ${new Date().getFullYear()} ${escapeHtml(labName)} ‚Äî Todos los derechos reservados.</footer>

</body>
</html>
  `;
}


/* ===========================================================
   PREVIEW
   =========================================================== */

function updatePreview() {
  const doc = previewIframe.contentDocument;
  doc.open();
  doc.write(generateFinalHtml());
  doc.close();
}


/* ===========================================================
   DESCARGAR HTML
   =========================================================== */

downloadBtn.addEventListener("click", () => {
  const html = generateFinalHtml();
  const blob = new Blob([html], { type: "text/html" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "landing.html";
  a.click();
  URL.revokeObjectURL(url);
});


/* ===========================================================
   ABRIR EN NUEVA PESTA√ëA
   =========================================================== */

openNewTabBtn.addEventListener("click", () => {
  const html = generateFinalHtml();
  const win = window.open();
  win.document.open();
  win.document.write(html);
  win.document.close();
});

/* Inicializar */
renderServices();
renderSectionsControls();
updatePreview();

</script>

</body>
</html>
